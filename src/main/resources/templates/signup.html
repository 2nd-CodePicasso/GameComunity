import React, { useState } from 'react';

const SignupForm = () => {
const [formData, setFormData] = useState({
loginId: '',
nickname: '',
password: '',
confirmPassword: ''
});

const [loading, setLoading] = useState(false);
const [error, setError] = useState('');
const [success, setSuccess] = useState(false);

const handleChange = (e) => {
const { name, value } = e.target;
setFormData(prevData => ({
...prevData,
[name]: value
}));
};

const validateForm = () => {
if (!formData.loginId.trim()) {
setError('아이디를 입력해주세요.');
return false;
}

if (!formData.nickname.trim()) {
setError('닉네임을 입력해주세요.');
return false;
}

if (!formData.password) {
setError('비밀번호를 입력해주세요.');
return false;
}

if (formData.password !== formData.confirmPassword) {
setError('비밀번호가 일치하지 않습니다.');
return false;
}

return true;
};

const handleSubmit = async (e) => {
e.preventDefault();
setError('');

if (!validateForm()) {
return;
}

try {
setLoading(true);

// 회원가입 요청 객체 생성 (UserRequest에 맞춤)
const userRequest = {
loginId: formData.loginId,
nickname: formData.nickname,
password: formData.password
};

// API 요청
const response = await fetch('/auth/hi/users', {
method: 'POST',
headers: {
'Content-Type': 'application/json'
},
body: JSON.stringify(userRequest)
});

const data = await response.json();

if (!response.ok) {
throw new Error(data.message || '회원가입에 실패했습니다.');
}

// 성공 처리
setSuccess(true);
setFormData({
loginId: '',
nickname: '',
password: '',
confirmPassword: ''
});

} catch (err) {
setError(err.message || '회원가입 중 오류가 발생했습니다.');
} finally {
setLoading(false);
}
};

return (
<div className="flex justify-center items-center min-h-screen bg-gray-100">
  <div className="bg-white p-8 rounded-lg shadow-md w-full max-w-md">
    <h2 className="text-2xl font-bold mb-6 text-center text-gray-800">회원가입</h2>

    {success ? (
    <div className="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4">
      <strong className="font-bold">성공!</strong>
      <span className="block sm:inline"> 회원가입이 완료되었습니다. 로그인해주세요.</span>
    </div>
    ) : (
    <form onSubmit={handleSubmit}>
      {error && (
      <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4">
        <span className="block sm:inline">{error}</span>
      </div>
      )}

      <div className="mb-4">
        <label htmlFor="loginId" className="block text-gray-700 text-sm font-bold mb-2">
          아이디
        </label>
        <input
                type="text"
                id="loginId"
                name="loginId"
                value={formData.loginId}
                onChange={handleChange}
                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                placeholder="아이디를 입력하세요"
        />
      </div>

      <div className="mb-4">
        <label htmlFor="nickname" className="block text-gray-700 text-sm font-bold mb-2">
          닉네임
        </label>
        <input
                type="text"
                id="nickname"
                name="nickname"
                value={formData.nickname}
                onChange={handleChange}
                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                placeholder="닉네임을 입력하세요"
        />
      </div>

      <div className="mb-4">
        <label htmlFor="password" className="block text-gray-700 text-sm font-bold mb-2">
          비밀번호
        </label>
        <input
                type="password"
                id="password"
                name="password"
                value={formData.password}
                onChange={handleChange}
                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                placeholder="비밀번호를 입력하세요"
        />
      </div>

      <div className="mb-6">
        <label htmlFor="confirmPassword" className="block text-gray-700 text-sm font-bold mb-2">
          비밀번호 확인
        </label>
        <input
                type="password"
                id="confirmPassword"
                name="confirmPassword"
                value={formData.confirmPassword}
                onChange={handleChange}
                className="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                placeholder="비밀번호를 다시 입력하세요"
        />
      </div>

      <div className="flex items-center justify-between">
        <button
                type="submit"
                className="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline w-full"
                disabled={loading}
        >
          {loading ? '처리 중...' : '회원가입'}
        </button>
      </div>

      <div className="mt-4 text-center text-sm">
        <span className="text-gray-600">이미 계정이 있으신가요?</span>
        <a href="/login" className="text-blue-500 hover:text-blue-700 ml-1">
          로그인하기
        </a>
      </div>
    </form>
    )}
  </div>
</div>
);
};

export default SignupForm;